<!DOCTYPE html>
<html>
<head>

<!-- Responsive -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<!-- Title -->
<title>Astronomy Picture of the Day</title>

<!-- Meta Tags required for Progressive Web App -->
<meta name="apple-mobile-web-app-status-bar" content="#aa7700">
<meta name="theme-color" content="black">

<!-- Manifest File link -->
<link rel="manifest" href="manifest.json">

<style>
    /* Ensure the image resizes dynamically */
    #apod {
        max-width: 100%; /* Ensures image fits the screen */
        height: auto; /* Maintains aspect ratio */
        display: block; /* Removes extra spacing */
        margin: 0 auto; /* Centers the image */
    }
</style>

</head>

<body>
    <img id="apod" alt="APOD Image">

    <script>
		if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
        .then(() => console.log("Service Worker Registered"))
        .catch((err) => console.error("Service Worker Error:", err));
}

        async function get_apod() {
            let api_url = "https://api.nasa.gov/planetary/apod?api_key=PV0qEJBHTvngHQBb4VNJQgCXxdyrlaCe5m42FQlJ";
            try {
                const response = await fetch(api_url);
                const json = await response.json();
                let image_url = json["hdurl"] || json["url"]; // Some images are not HD, fallback to normal

                let img = document.getElementById("apod");
                img.src = image_url;

                // Wait for image to load before setting dimensions
                img.onload = function () {
                    img.style.width = this.naturalWidth + "px";
                    img.style.height = this.naturalHeight + "px";
                };

            } catch (error) {
                console.error("Error fetching APOD image:", error);
            }
        }

        // Call the function when the page loads
        window.onload = get_apod;
    </script>
</body>
</html>
